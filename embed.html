<div class="produto-container" data-produto-id="11102">
  <div class="produto-imagem">
    <img class="produto-imagem-src" src="" alt="Produto" />
  </div>

  <div class="produto-info">
    <h1 class="produto-nome">Nome do Produto</h1>

    <div class="produto-preco">
      <p class="preco produto-preco-final">R$ 0,00</p>
      <p class="preco-promocional produto-preco-promocional"></p>
      <p class="preco-pix produto-preco-pix"></p>
    </div>

    <div class="produto-tamanhos">
      <span class="tamanho-title">Tamanho</span>
      <div class="lista-tamanhos tamanhos"></div>
    </div>

    <button class="btn-comprar">COMPRAR</button>
  </div>
</div>

<style>
  /* (mantive o seu CSS) */
  .produto-container{display:flex;gap:40px;align-items:center;font-family:Arial, sans-serif;margin:20px auto;max-width:1200px;background:#fdfdfd}
  .produto-imagem{display:flex;justify-content:center;align-items:center;background:#eee;border-radius:10px;padding:10px}
  .produto-imagem img{max-width:350px;width:100%;border:2px solid #fff;border-radius:8px;display:block;filter:brightness(0.95) contrast(1.05)}
  .produto-info{flex:1;padding:20px 20px}
  .produto-info h1{font-size:22px;margin-bottom:10px}
  .produto-preco{margin:20px 0}
  .preco{font-size:22px;font-weight:bold;color:#333}
  .preco-promocional{font-size:18px;text-decoration:line-through;color:#888}
  .preco-pix{font-size:14px}
  .produto-tamanhos{margin:20px 0}
  .tamanho-title{display:block;margin-bottom:10px;font-weight:bold;font-size:14px}
  .tamanhos{display:flex;flex-wrap:wrap;gap:10px}
  .tamanho-btn{border:1px solid #ccc;padding:8px 12px;cursor:pointer;background:#fff;border-radius:4px;transition:all .2s ease}
  .tamanho-btn:hover{border-color:#000}
  .tamanho-btn.selected{border:2px solid #000;font-weight:bold}
  .tamanho-btn.disabled{background:#f5f5f5;color:#aaa;border:1px solid #ddd;cursor:not-allowed}
  .btn-comprar{background:#0070f3;color:#fff;border:none;padding:15px 25px;font-size:16px;cursor:pointer;border-radius:6px;margin-top:20px;width:100%;max-width:400px;transition:background .3s ease}
  .btn-comprar:hover{background:#005bb5}
  @media (max-width:768px){.produto-container{flex-direction:column;align-items:center;gap:20px;margin:20px}.produto-info{width:100%}.produto-info h1{font-size:20px;text-align:center}.produto-preco{text-align:center}.produto-tamanhos{text-align:center}.tamanhos{justify-content:center}.btn-comprar{width:100%}}
</style>

<script>
  (function () {
    const CHECKOUT_DOMAIN = 'https://www.doctorshoes.com.br';

    // Apenas gera a URL e redireciona
    function addToCartThenRedirect(sku) {
      const url = `${CHECKOUT_DOMAIN}/checkout/cart/add?sku=${encodeURIComponent(sku)}&qty=1&seller=1&sc=1&utm_source=blog&utm_medium=embed_product`;
      window.location.href = url;
    }

    async function carregarProdutoNoContainer(container) {
      const id = container.dataset.produtoId;
      let skuSelecionado = null;

      try {
        const res = await fetch(`https://proxy-vtex-murex.vercel.app/api/produto?id=${id}`);
        const data = await res.json();
        if (!data || data.length === 0) return;

        const produto = data[0];
        const nome = produto.productName;
        const imagem = produto.items[0]?.images[0]?.imageUrl || '';
        const itens = produto.items;

        container.querySelector('.produto-nome').textContent = nome;
        container.querySelector('.produto-imagem-src').src = imagem;

        // Preço
        const oferta = itens[0].sellers[0].commertialOffer || {};
        const preco = oferta.ListPrice || 0;
        const precoFinal = oferta.Price || 0;
        const precoPix = precoFinal * 0.95;

        container.querySelector('.produto-preco-final').textContent =
          'R$ ' + precoFinal.toFixed(2).replace('.', ',');
        if (preco > precoFinal) {
          container.querySelector('.produto-preco-promocional').textContent =
            'De R$ ' + preco.toFixed(2).replace('.', ',');
        }
        container.querySelector('.produto-preco-pix').textContent =
          'R$ ' + precoPix.toFixed(2).replace('.', ',') + ' à vista no PIX (5% OFF)';

        // Tamanhos
        const listaTamanhos = container.querySelector('.lista-tamanhos');
        listaTamanhos.innerHTML = '';

        itens.forEach(item => {
          const tamanho = item.Tamanho || item.name || item.itemId;
          const btn = document.createElement('button');
          btn.textContent = tamanho;

          const ofertaItem = item.sellers[0].commertialOffer || {};
          const temEstoque = (Number(ofertaItem.AvailableQuantity) > 0);

          if (!temEstoque) {
            btn.className = 'tamanho-btn disabled';
            btn.disabled = true;
          } else {
            btn.className = 'tamanho-btn';
            btn.addEventListener('click', () => {
              if (btn.disabled) return;
              skuSelecionado = item.itemId;
              listaTamanhos.querySelectorAll('.tamanho-btn').forEach(b => b.classList.remove('selected'));
              btn.classList.add('selected');
            });
          }
          listaTamanhos.appendChild(btn);
        });

        // Comprar
        const buyBtn = container.querySelector('.btn-comprar');
        buyBtn.addEventListener('click', () => {
          if (!skuSelecionado) {
            alert('Selecione um tamanho disponível antes de comprar!');
            return;
          }
          buyBtn.disabled = true;
          addToCartThenRedirect(skuSelecionado);
        });

      } catch (err) {
        console.error('Erro ao carregar produto:', err);
      }
    }

    // Inicializa todos os blocos
    document.querySelectorAll('.produto-container[data-produto-id]').forEach(container => {
      carregarProdutoNoContainer(container);
    });

  })();
</script>